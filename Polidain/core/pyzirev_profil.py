import math
import numpy as np
from scipy.interpolate import CubicSpline


# Таблица X,Y
data = [
    (17.8009, 0.0000),
    (17.7982, 0.3107),
    (17.7901, 0.6213),
    (17.7765, 0.9316),
    (17.7575, 1.2418),
    (17.7332, 1.5515),
    (17.7034, 1.8607),
    (17.6682, 2.1694),
    (17.6277, 2.4774),
    (17.5818, 2.7847),
    (17.5305, 3.0911),
    (17.4739, 3.3966),
    (17.4118, 3.7010),
    (17.3447, 4.0043),
    (17.2722, 4.3064),
    (17.1944, 4.6072),
    (17.1114, 4.9066),
    (17.0230, 5.2044),
    (16.9297, 5.5008),
    (16.8310, 5.7954),
    (16.7274, 6.0883),
    (16.6185, 6.3792),
    (16.5048, 6.6683),
    (16.3858, 6.9554),
    (16.2619, 7.2403),
    (16.1331, 7.5230),
    (15.9993, 7.8034),
    (15.8607, 8.0814),
    (15.7173, 8.3571),
    (15.5689, 8.6300),
    (15.4161, 8.9005),
    (15.2584, 9.1681),
    (15.0961, 9.4331),
    (14.9290, 9.6950),
    (14.7576, 9.9542),
    (14.5817, 10.2102),
    (14.4012, 10.4631),
    (14.2164, 10.7128),
    (14.0273, 10.9594),
    (13.8339, 11.2025),
    (13.6363, 11.4422),
    (13.4345, 11.6785),
    (13.2286, 11.9111),
    (13.0188, 12.1402),
    (12.8048, 12.3655),
    (12.5872, 12.5872),
    (12.3655, 12.8048),
    (12.1402, 13.0188),
    (11.9111, 13.2286),
    (11.6785, 13.4345),
    (11.4422, 13.6363),
    (11.2025, 13.8339),
    (10.9594, 14.0273),
    (10.7128, 14.2164),
    (10.4631, 14.4012),
    (10.2102, 14.5817),
    (9.9542, 14.7576),
    (9.6950, 14.9290),
    (9.4331, 15.0961),
    (9.1681, 15.2584),
    (8.9005, 15.4161),
    (8.6300, 15.5690),
    (8.3570, 15.7173),
    (8.0815, 15.8608),
    (7.8034, 15.9994),
    (7.5231, 16.1333),
    (7.2404, 16.2622),
    (6.9557, 16.3865),
    (6.6687, 16.5056),
    (6.3799, 16.6201),
    (6.0891, 16.7296),
    (5.7966, 16.8347),
    (5.5025, 16.9349),
    (5.2068, 17.0307),
    (4.9096, 17.1218),
    (4.6110, 17.2086),
    (4.3111, 17.2911),
    (4.0100, 17.3691),
    (3.7076, 17.4430),
    (3.4041, 17.5126),
    (3.0994, 17.5779),
    (2.7937, 17.6390),
    (2.4869, 17.6959),
    (2.1792, 17.7481),
    (1.8704, 17.7961),
    (1.5607, 17.8394),
    (1.2501, 17.8781),
    (0.9387, 17.9120),
    (0.6265, 17.9407),
    (0.3135, 17.9646),
    (0.0000, 17.9832),
    (-0.3142, 17.9966),
    (-0.6288, 18.0043),
    (-0.9437, 18.0069),
    (-1.2590, 18.0037),
    (-1.5744, 17.9950),
    (-1.8899, 17.9808),
    (-2.2054, 17.9607),
    (-2.5207, 17.9353),
    (-2.8358, 17.9040),
    (-3.1505, 17.8674),
    (-3.4649, 17.8253),
    (-3.7789, 17.7783),
    (-4.0925, 17.7264),
    (-4.4058, 17.6702),
    (-4.7187, 17.6100),
    (-5.0315, 17.5463),
    (-5.3441, 17.4793),
    (-5.6569, 17.4094),
    (-5.9698, 17.3366),
    (-6.2829, 17.2613),
    (-6.5965, 17.1834),
    (-6.9106, 17.1033),
    (-7.2254, 17.0209),
    (-7.5410, 16.9363),
    (-7.8575, 16.8493),
    (-8.1751, 16.7603),
    (-8.4940, 16.6691),
    (-8.8141, 16.5757),
    (-9.1358, 16.4800),
    (-9.4591, 16.3823),
    (-9.7842, 16.2821),
    (-10.1112, 16.1797),
    (-10.4402, 16.0749),
    (-10.7714, 15.9676),
    (-11.1050, 15.8580),
    (-11.4411, 15.7457),
    (-11.7800, 15.6308),
    (-12.1216, 15.5131),
    (-12.4662, 15.3928),
    (-12.8140, 15.2693),
    (-13.1651, 15.1428),
    (-13.5196, 15.0132),
    (-13.8779, 14.8803),
    (-14.2399, 14.7438),
    (-14.6060, 14.6038),
    (-14.9762, 14.4603),
    (-15.3507, 14.3126),
    (-15.7298, 14.1610),
    (-16.1135, 14.0051),
    (-16.5022, 13.8448),
    (-16.8958, 13.6796),
    (-17.2946, 13.5097),
    (-17.6987, 13.3345),
    (-18.1084, 13.1542),
    (-18.5235, 12.9678),
    (-18.9445, 12.7760),
    (-19.3712, 12.5774),
    (-19.8039, 12.3725),
    (-20.2423, 12.1605),
    (-20.6867, 11.9412),
    (-21.1367, 11.7140),
    (-21.5924, 11.4787),
    (-22.0534, 11.2347),
    (-22.5192, 10.9814),
    (-22.9895, 10.7185),
    (-23.4633, 10.4450),
    (-23.9398, 10.1607),
    (-24.4176, 9.8645),
    (-24.8953, 9.5561),
    (-25.3709, 9.2343),
    (-25.8424, 8.8989),
    (-26.3071, 8.5491),
    (-26.7616, 8.1841),
    (-27.2021, 7.8032),
    (-27.6242, 7.4055),
    (-28.0245, 6.9911),
    (-28.4004, 6.5604),
    (-28.7510, 6.1147),
    (-29.0751, 5.6549),
    (-29.3725, 5.1821),
    (-29.6425, 4.6976),
    (-29.8849, 4.2024),
    (-30.0991, 3.6978),
    (-30.2851, 3.1849),
    (-30.4429, 2.6649),
    (-30.5721, 2.1390),
    (-30.6727, 1.6084),
    (-30.7447, 1.0742),
    (-30.7878, 0.5377),
    (-30.8022, 0.0000),
    (-30.7878, -0.5377),
    (-30.7447, -1.0742),
    (-30.6727, -1.6084),
    (-30.5721, -2.1390),
    (-30.4429, -2.6649),
    (-30.2851, -3.1849),
    (-30.0991, -3.6978),
    (-29.8849, -4.2024),
    (-29.6425, -4.6976),
    (-29.3725, -5.1821),
    (-29.0751, -5.6549),
    (-28.7510, -6.1147),
    (-28.4004, -6.5604),
    (-28.0245, -6.9911),
    (-27.6242, -7.4055),
    (-27.2021, -7.8032),
    (-26.7616, -8.1841),
    (-26.3071, -8.5491),
    (-25.8424, -8.8989),
    (-25.3709, -9.2343),
    (-24.8953, -9.5561),
    (-24.4176, -9.8645),
    (-23.9398, -10.1607),
    (-23.4633, -10.4450),
    (-22.9895, -10.7185),
    (-22.5192, -10.9814),
    (-22.0534, -11.2347),
    (-21.5924, -11.4787),
    (-21.1367, -11.7140),
    (-20.6867, -11.9412),
    (-20.2423, -12.1605),
    (-19.8039, -12.3725),
    (-19.3712, -12.5774),
    (-18.9445, -12.7760),
    (-18.5235, -12.9678),
    (-18.1084, -13.1542),
    (-17.6987, -13.3345),
    (-17.2946, -13.5097),
    (-16.8958, -13.6796),
    (-16.5022, -13.8448),
    (-16.1135, -14.0051),
    (-15.7298, -14.1610),
    (-15.3507, -14.3126),
    (-14.9762, -14.4603),
    (-14.6060, -14.6038),
    (-14.2399, -14.7438),
    (-13.8779, -14.8803),
    (-13.5196, -15.0132),
    (-13.1651, -15.1428),
    (-12.8140, -15.2693),
    (-12.4662, -15.3928),
    (-12.1216, -15.5131),
    (-11.7800, -15.6308),
    (-11.4411, -15.7457),
    (-11.1050, -15.8580),
    (-10.7714, -15.9676),
    (-10.4402, -16.0749),
    (-10.1112, -16.1797),
    (-9.7842, -16.2821),
    (-9.4591, -16.3823),
    (-9.1358, -16.4800),
    (-8.8141, -16.5757),
    (-8.4940, -16.6691),
    (-8.1751, -16.7603),
    (-7.8575, -16.8493),
    (-7.5410, -16.9363),
    (-7.2254, -17.0209),
    (-6.9106, -17.1033),
    (-6.5965, -17.1834),
    (-6.2829, -17.2613),
    (-5.9698, -17.3366),
    (-5.6569, -17.4094),
    (-5.3441, -17.4793),
    (-5.0315, -17.5463),
    (-4.7187, -17.6100),
    (-4.4058, -17.6702),
    (-4.0925, -17.7264),
    (-3.7789, -17.7783),
    (-3.4649, -17.8253),
    (-3.1505, -17.8674),
    (-2.8358, -17.9040),
    (-2.5207, -17.9353),
    (-2.2054, -17.9607),
    (-1.8899, -17.9808),
    (-1.5744, -17.9950),
    (-1.2590, -18.0037),
    (-0.9437, -18.0069),
    (-0.6288, -18.0043),
    (-0.3142, -17.9966),
    (0.0000, -17.9832),
    (0.3135, -17.9646),
    (0.6265, -17.9407),
    (0.9387, -17.9120),
    (1.2501, -17.8781),
    (1.5607, -17.8394),
    (1.8704, -17.7961),
    (2.1792, -17.7481),
    (2.4869, -17.6959),
    (2.7937, -17.6390),
    (3.0994, -17.5779),
    (3.4041, -17.5126),
    (3.7076, -17.4430),
    (4.0100, -17.3691),
    (4.3111, -17.2911),
    (4.6110, -17.2086),
    (4.9096, -17.1218),
    (5.2068, -17.0307),
    (5.5025, -16.9349),
    (5.7966, -16.8347),
    (6.0891, -16.7296),
    (6.3799, -16.6201),
    (6.6687, -16.5056),
    (6.9557, -16.3865),
    (7.2404, -16.2622),
    (7.5231, -16.1333),
    (7.8034, -15.9994),
    (8.0815, -15.8608),
    (8.3570, -15.7173),
    (8.6300, -15.5690),
    (8.9005, -15.4161),
    (9.1681, -15.2584),
    (9.4331, -15.0961),
    (9.6950, -14.9290),
    (9.9542, -14.7576),
    (10.2102, -14.5817),
    (10.4631, -14.4012),
    (10.7128, -14.2164),
    (10.9594, -14.0273),
    (11.2025, -13.8339),
    (11.4422, -13.6363),
    (11.6785, -13.4345),
    (11.9111, -13.2286),
    (12.1402, -13.0188),
    (12.3655, -12.8048),
    (12.5872, -12.5872),
    (12.8048, -12.3655),
    (13.0188, -12.1402),
    (13.2286, -11.9111),
    (13.4345, -11.6785),
    (13.6363, -11.4422),
    (13.8339, -11.2025),
    (14.0273, -10.9594),
    (14.2164, -10.7128),
    (14.4012, -10.4631),
    (14.5817, -10.2102),
    (14.7576, -9.9542),
    (14.9290, -9.6950),
    (15.0961, -9.4331),
    (15.2584, -9.1681),
    (15.4161, -8.9005),
    (15.5689, -8.6300),
    (15.7173, -8.3571),
    (15.8607, -8.0814),
    (15.9993, -7.8034),
    (16.1331, -7.5230),
    (16.2619, -7.2403),
    (16.3858, -6.9554),
    (16.5048, -6.6683),
    (16.6185, -6.3792),
    (16.7274, -6.0883),
    (16.8310, -5.7954),
    (16.9297, -5.5008),
    (17.0230, -5.2044),
    (17.1114, -4.9066),
    (17.1944, -4.6072),
    (17.2722, -4.3064),
    (17.3447, -4.0043),
    (17.4118, -3.7010),
    (17.4739, -3.3966),
    (17.5305, -3.0911),
    (17.5818, -2.7847),
    (17.6277, -2.4774),
    (17.6682, -2.1694),
    (17.7034, -1.8607),
    (17.7332, -1.5515),
    (17.7575, -1.2418),
    (17.7765, -0.9316),
    (17.7901, -0.6213),
    (17.7982, -0.3107),
]

# Преобразование в полярные координаты
X = []
Y = []
R = []
FI = []
for x, y in data:
    X.append(x)
    Y.append(y)
    r = math.hypot(x, y)
    if y >= 0:
        phi = math.atan2(y, x)
    else:
        phi = 2 * math.pi + math.atan2(y, x)   # угол в радианах
    R.append(r)
    FI.append(phi)
np.append(R, R[0])            # Дублируем радиус первой точки в конец
np.append(FI, FI[0] + 2*math.pi) # Дублируем угол первой точки + полный оборот

FI = np.array(FI)
R = np.array(R)

# Cортируем массивы
sorted_indices = np.argsort(FI)
FI = FI[sorted_indices]
R = R[sorted_indices]

# Интерполяция и производные с помощью CubicSpline
cs = CubicSpline(FI, R, bc_type='periodic')

# Создаем функции для производных
R_func = cs                 # Сама функция R(phi)
dR_func = cs.derivative(1)  # Первая производная R'(phi)
d2R_func = cs.derivative(2) # Вторая производная R''(phi)
d3R_func = cs.derivative(3) # Третья производная R'''(phi)

# Получение значений (пример для графика с большим числом точек)
FI = np.linspace(0, 2 * math.pi, 100)
R = R_func(FI)
V = dR_func(FI)
A = d2R_func(FI)
D = d3R_func(FI)

if __name__ == "__main__":
    import matplotlib.pyplot as plt

    plt.figure(figsize=(6, 6))
    plt.plot(X, Y)
    plt.grid(True)
    plt.scatter(0, 0, c='r')
    plt.xlim(min(X)-1, max(X)+1)
    plt.ylim(min(Y)-1, max(Y)+1)
    plt.show()

    plt.plot(FI, R)
    plt.xlabel('phi, град')
    plt.ylabel('R')
    plt.grid(True)
    plt.show()

    plt.plot(FI, V)
    plt.xlabel('phi, град')
    plt.ylabel('V')
    plt.grid(True)
    plt.show()

    plt.plot(FI, A)
    plt.xlabel('phi, град')
    plt.ylabel('A')
    plt.grid(True)
    plt.show()

    plt.plot(FI, D)
    plt.xlabel('phi, град')
    plt.ylabel('D')
    plt.grid(True)
    plt.show()